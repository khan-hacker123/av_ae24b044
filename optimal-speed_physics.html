<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadcopter Flight Performance Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Slate & Cyan Harmony -->
    <!-- Application Structure Plan: A single-page, vertically scrolling narrative. It starts with the core concept (the U-shaped power curve), lets the user play with an interactive simulator to understand the dynamics, explains the key takeaways (optimal speeds for range/endurance), describes a typical flight journey, and finally delves into the "how" (avionics and control logic). This guided-learning structure is more intuitive for a complex topic than a dashboard, as it builds knowledge progressively. -->
    <!-- Visualization & Content Choices: The central element is an interactive Chart.js line chart showing power vs. speed. This visualization is directly manipulated by a flight simulator (slider/buttons), providing immediate feedback. Key concepts like V_mp and V_mr are visually marked on the chart. Complex formulas and code are hidden by default in expandable toggles to avoid overwhelming users. A new section details a flight journey with 8 interactive situations, integrating concepts of power consumption, wind effects, and maneuvers within a narrative, with detailed explanations and assumptions for each. This approach combines high-level interactive learning with deep-dive information for those interested, all without using SVG or Mermaid. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .formula { font-family: 'Courier New', monospace; background-color: #f0f0f0; padding: 2px 6px; border-radius: 4px; }
        .smooth-transition { transition: all 0.3s ease-in-out; }
        .section-title { font-size: 1.875rem; font-weight: 700; line-height: 2.25rem; margin-bottom: 1rem; text-align: center; }
        .section-intro { max-width: 48rem; margin: 0 auto 2rem; text-align: center; color: #4b5563; }
        .card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); padding: 1.5rem; }
        .toggle-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out; }
        .condition-btn.active {
            background-color: #0891b2; /* cyan-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(8, 145, 178, 0.3), 0 2px 4px -2px rgba(8, 145, 178, 0.3);
        }
        .condition-btn {
            background-color: #f1f5f9; /* slate-100 */
            color: #475569; /* slate-600 */
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s ease-in-out;
            border: 1px solid #e2e8f0; /* slate-200 */
        }
        .condition-btn:hover:not(.active) {
            background-color: #e2e8f0; /* slate-200 */
            color: #1e293b; /* slate-900 */
        }
        .journey-btn {
            background-color: #f1f5f9;
            color: #475569;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s ease-in-out;
            border: 1px solid #e2e8f0;
        }
        .journey-btn.active {
            background-color: #0891b2;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(8, 145, 178, 0.3), 0 2px 4px -2px rgba(8, 145, 178, 0.3);
        }
        .journey-btn:hover:not(.active) {
            background-color: #e2e8f0;
            color: #1e293b;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold text-slate-900">eVTOL Flight Dynamics</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#physics" class="text-slate-600 hover:bg-slate-100 hover:text-slate-900 px-3 py-2 rounded-md text-sm font-medium">The Physics</a>
                        <a href="#simulator" class="text-slate-600 hover:bg-slate-100 hover:text-slate-900 px-3 py-2 rounded-md text-sm font-medium">Simulator</a>
                        <a href="#optimization" class="text-slate-600 hover:bg-slate-100 hover:text-slate-900 px-3 py-2 rounded-md text-sm font-medium">Optimization</a>
                        <a href="#journey" class="text-slate-600 hover:bg-slate-100 hover:text-slate-900 px-3 py-2 rounded-md text-sm font-medium">Flight Journey</a>
                        <a href="#avionics" class="text-slate-600 hover:bg-slate-100 hover:text-slate-900 px-3 py-2 rounded-md text-sm font-medium">Avionics</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
        
        <section id="intro" class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4">Quadcopter Flight Performance Deep Dive</h1>
            <p class="max-w-3xl mx-auto text-lg text-slate-600">
                Analyzing the critical balance between speed, power, and range for a large 1-seater eVTOL. This interactive guide explores the physics of electric flight to reveal how efficiency is key to practical, long-range missions.
            </p>
        </section>

        <section id="physics" class="mb-16 scroll-mt-20">
            <h2 class="section-title">The Physics of Power Consumption</h2>
            <p class="section-intro">
                A quadcopter's power usage is a combination of forces, each changing with speed. Their sum creates a distinct "U-shaped" power curve, which is the key to understanding flight efficiency. Below, you can explore this curve and its components.
            </p>
            <div class="card">
                <div class="chart-container relative w-full max-w-4xl mx-auto h-72 md:h-96">
                    <canvas id="powerCurveChart"></canvas>
                </div>
                <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-2 text-center">
                    <button id="btnInduced" class="power-btn border-2 border-blue-500 bg-blue-500 text-white py-2 px-4 rounded-lg smooth-transition">Induced</button>
                    <button id="btnParasitic" class="power-btn border-2 border-red-500 bg-white text-red-500 py-2 px-4 rounded-lg smooth-transition">Parasitic</button>
                    <button id="btnProfile" class="power-btn border-2 border-green-500 bg-white text-green-500 py-2 px-4 rounded-lg smooth-transition">Profile</button>
                    <button id="btnTotal" class="power-btn border-2 border-slate-800 bg-white text-slate-800 py-2 px-4 rounded-lg smooth-transition">Total</button>
                </div>
                <div id="powerExplanation" class="mt-4 p-4 bg-slate-100 rounded-lg">
                    <h3 id="explanationTitle" class="font-bold text-lg mb-2 text-blue-700">Induced Power</h3>
                    <p id="explanationText" class="text-slate-700">The power required to generate lift by pushing air downwards. It's highest when hovering and decreases as the drone moves forward and gains aerodynamic lift.</p>
                </div>
            </div>
        </section>

        <section id="simulator" class="mb-16 scroll-mt-20">
            <h2 class="section-title">Interactive Performance Simulator</h2>
            <p class="section-intro">
                Adjust the drone's speed and flight conditions to see the real-time impact on its power needs and performance. Observe how the marker moves along the power curve and how the estimated range and flight time change.
            </p>
            <div class="card md:grid md:grid-cols-3 md:gap-8 items-center">
                <div class="md:col-span-2">
                    <label for="speedSlider" class="block text-lg font-medium mb-2">Cruising Speed: <span id="speedValue" class="font-bold text-cyan-600">75</span> km/h</label>
                    <input id="speedSlider" type="range" min="1" max="150" value="75" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                    
                    <div class="mt-6">
                        <label class="block text-lg font-medium mb-2">Flight Condition</label>
                        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2">
                            <button class="condition-btn active" data-condition="calm">Calm Air</button>
                            <button class="condition-btn" data-condition="headwind">Headwind</button>
                            <button class="condition-btn" data-condition="tailwind">Tailwind</button>
                            <button class="condition-btn" data-condition="turn">Standard Turn</button>
                            <button class="condition-btn" data-condition="turbulence">Turbulence</button>
                            <button class="condition-btn" data-condition="high_alt">High Altitude</button>
                            <button class="condition-btn" data-condition="ascent">Ascent</button>
                            <button class="condition-btn" data-condition="descent">Descent</button>
                        </div>
                    </div>
                </div>
                <div class="mt-8 md:mt-0 md:col-span-1 space-y-4 text-center">
                    <div class="p-4 bg-slate-100 rounded-lg">
                        <p class="text-sm text-slate-500">Power Consumption</p>
                        <p id="powerOutput" class="text-3xl font-bold text-cyan-700">-- kW</p>
                    </div>
                    <div class="p-4 bg-slate-100 rounded-lg">
                        <p class="text-sm text-slate-500">Estimated Flight Time</p>
                        <p id="timeOutput" class="text-3xl font-bold text-cyan-700">-- min</p>
                    </div>
                    <div class="p-4 bg-slate-100 rounded-lg">
                        <p class="text-sm text-slate-500">Estimated Range</p>
                        <p id="rangeOutput" class="text-3xl font-bold text-cyan-700">-- km</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="optimization" class="mb-16 scroll-mt-20">
            <h2 class="section-title">Optimal Speed Analysis</h2>
            <p class="section-intro">
                "Optimal" speed depends on the mission. Flying for the longest time (endurance) requires a different speed than flying the farthest distance (range). These two "sweet spots" are critical for mission planning.
            </p>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="card">
                    <h3 class="text-xl font-bold mb-2">Maximum Endurance Speed (V<sub>mp</sub>)</h3>
                    <p class="text-slate-600 mb-4">The speed that uses the least power, keeping the drone airborne for the maximum possible time. Ideal for loitering, surveillance, or observation tasks.</p>
                    <div class="text-center bg-slate-100 p-4 rounded-lg mb-4">
                        <p class="text-4xl font-bold text-cyan-700" id="vmpValue">-- km/h</p>
                    </div>
                    <button class="toggle-btn w-full text-left font-semibold text-cyan-600">View Formula & Terms ▼</button>
                    <div class="toggle-content mt-2">
                        <p class="font-semibold">Formula for V<sub>mp</sub>:</p>
                        <p class="formula text-sm">V_mp = [(2 * W) / (ρ * A * C_D0 * 3 * π * AR * e)]^(1/4)</p>
                        <ul class="list-disc list-inside mt-2 text-sm text-slate-600 space-y-1">
                            <li><b>W:</b> Weight</li>
                            <li><b>ρ:</b> Air Density</li>
                            <li><b>A:</b> Rotor Disk Area</li>
                            <li><b>C_D0:</b> Zero-lift Drag Coefficient</li>
                            <li><b>AR:</b> Aspect Ratio</li>
                            <li><b>e:</b> Oswald Efficiency Factor</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h3 class="text-xl font-bold mb-2">Maximum Range Speed (V<sub>mr</sub>)</h3>
                    <p class="text-slate-600 mb-4">The speed that covers the most distance per unit of energy. This is faster than V<sub>mp</sub> and is essential for long-distance transport or mapping missions.</p>
                    <div class="text-center bg-slate-100 p-4 rounded-lg mb-4">
                        <p class="text-4xl font-bold text-cyan-700" id="vmrValue">-- km/h</p>
                    </div>
                    <button class="toggle-btn w-full text-left font-semibold text-cyan-600">View Formula & Terms ▼</button>
                    <div class="toggle-content mt-2">
                        <p class="font-semibold">Formula for V<sub>mr</sub>:</p>
                        <p class="formula text-sm">V_mr = [(2 * W) / (ρ * A * C_D0 * π * AR * e)]^(1/4)</p>
                        <ul class="list-disc list-inside mt-2 text-sm text-slate-600 space-y-1">
                            <li><b>W:</b> Weight</li>
                            <li><b>ρ:</b> Air Density</li>
                            <li><b>A:</b> Rotor Disk Area</li>
                            <li><b>C_D0:</b> Zero-lift Drag Coefficient</li>
                            <li><b>AR:</b> Aspect Ratio</li>
                            <li><b>e:</b> Oswald Efficiency Factor</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="journey" class="mb-16 scroll-mt-20">
            <h2 class="section-title">A Typical eVTOL Flight Journey</h2>
            <p class="section-intro">
                An eVTOL mission is a dynamic sequence of phases, each with unique power demands and considerations. Select a phase to understand its details, assumptions, and impact on battery consumption.
            </p>
            <div class="card space-y-6">
                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2 mb-4">
                    <button class="journey-btn active" data-phase="takeoff">Takeoff & Ascent</button>
                    <button class="journey-btn" data-phase="cruise_calm">Cruise (Calm Air)</button>
                    <button class="journey-btn" data-phase="cruise_headwind">Cruise (Headwind)</button>
                    <button class="journey-btn" data-phase="cruise_tailwind">Cruise (Tailwind)</button>
                    <button class="journey-btn" data-phase="high_altitude">High Altitude Cruise</button>
                    <button class="journey-btn" data-phase="flight_turns">Flight Turns</button>
                    <button class="journey-btn" data-phase="ascent_maneuver">Ascent Maneuver</button>
                    <button class="journey-btn" data-phase="descent_landing">Descent & Landing</button>
                </div>

                <div id="journey-detail-area" class="p-4 bg-slate-100 rounded-lg">
                    <h3 id="journey-title" class="font-bold text-xl mb-2 text-cyan-700">1. Takeoff & Initial Ascent</h3>
                    <p id="journey-explanation" class="text-slate-700 mb-2">
                        The mission begins with a vertical takeoff. This phase demands the highest power, as the rotors must generate enough thrust to overcome the drone's entire weight. Induced power is at its maximum here. As the eVTOL transitions from a hover to a gentle forward ascent, the power demand slightly decreases due to dynamic lift. Battery consumption is significant during this initial burst.
                    </p>
                    <p id="journey-assumptions" class="text-sm text-slate-600 italic">
                        <b>Assumptions:</b> Vertical takeoff, constant ascent rate (e.g., 2 m/s), high instantaneous power draw.
                    </p>
                    <p id="journey-power-impact" class="text-sm text-slate-600">
                        <b>Power Impact:</b> Very High.
                    </p>
                </div>
            </div>
        </section>

        <section id="avionics" class="scroll-mt-20">
            <h2 class="section-title">Avionics & Flight Control for Optimization</h2>
            <p class="section-intro">
                Achieving optimal flight isn't just about physics; it's about intelligent, real-time control. Modern avionics use sophisticated sensors and algorithms to constantly adjust for changing conditions and maintain peak efficiency.
            </p>
            <div class="card">
                <h3 class="text-xl font-bold mb-4">Conceptual Control Logic</h3>
                <div class="mb-4 border-b border-slate-200">
                    <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                        <button id="tab-speed" class="code-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-cyan-500 text-cyan-600">Real-time Speed Optimization</button>
                        <button id="tab-power" class="code-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300">Power Management</button>
                    </nav>
                </div>
                <div id="code-speed" class="code-content">
                    <pre class="bg-slate-800 text-white p-4 rounded-lg text-sm overflow-x-auto"><code><span class="text-cyan-400">FUNCTION</span> OptimizeCruiseSpeed(mission_objective, wind_data)
    <span class="text-green-400">// Get pre-calculated optimal speeds for calm air</span>
    V_mp_calm = get_optimal_endurance_speed()
    V_mr_calm = get_optimal_range_speed()

    <span class="text-green-400">// Set target based on mission</span>
    <span class="text-pink-400">IF</span> mission_objective == "MAX_RANGE" <span class="text-pink-400">THEN</span>
        target_airspeed = V_mr_calm
    <span class="text-pink-400">ELSE IF</span> mission_objective == "MAX_ENDURANCE" <span class="text-pink-400">THEN</span>
        target_airspeed = V_mp_calm
    <span class="text-pink-400">END IF</span>

    <span class="text-green-400">// Adjust for wind to maintain desired ground speed</span>
    adjusted_airspeed = target_airspeed - get_wind_component(wind_data)

    <span class="text-green-400">// Ensure speed is within drone's physical limits</span>
    adjusted_airspeed = CLAMP(adjusted_airspeed, MIN_SPEED, MAX_SPEED)
    
    <span class="text-green-400">// Check if battery can support the plan</span>
    <span class="text-pink-400">IF</span> !can_complete_mission(adjusted_airspeed) <span class="text-pink-400">THEN</span>
        <span class="text-green-400">// If not, reduce speed to conserve power</span>
        adjusted_airspeed = adjusted_airspeed * 0.95
    <span class="text-pink-400">END IF</span>

    <span class="text-pink-400">RETURN</span> adjusted_airspeed
<span class="text-cyan-400">END FUNCTION</span></code></pre>
                </div>
                <div id="code-power" class="code-content hidden">
                    <pre class="bg-slate-800 text-white p-4 rounded-lg text-sm overflow-x-auto"><code><span class="text-cyan-400">FUNCTION</span> ManagePowerForManeuver(maneuver_type, battery_voltage)
    base_power = CalculatePowerConsumption(current_speed, "calm")

    <span class="text-pink-400">IF</span> maneuver_type == "TURN" <span class="text-pink-400">TH1EN</span>
        maneuver_power_cost = base_power * 1.2 <span class="text-green-400">// 20% power increase</span>
    <span class="text-pink-400">ELSE IF</span> maneuver_type == "ASCENT" <span class="text-pink-400">THEN</span>
        power_for_climb = drone_weight * climb_rate
        maneuver_power_cost = base_power + power_for_climb
    <span class="text-pink-400">ELSE IF</span> maneuver_type == "TURBULENCE" <span class="text-pink-400">THEN</span>
        maneuver_power_cost = base_power * 1.1 <span class="text-green-400">// 10% for stability</span>
    <span class="text-pink-400">END IF</span>

    <span class="text-green-400">// Safety Check</span>
    <span class="text-pink-400">IF</span> battery_voltage < CRITICAL_VOLTAGE <span class="text-pink-400">THEN</span>
        LOG("Battery critical! Reducing maneuver intensity.")
        <span class="text-pink-400">RETURN</span> maneuver_power_cost * 0.5 <span class="text-green-400">// Halve power usage</span>
    <span class="text-pink-400">END IF</span>

    <span class="text-pink-400">RETURN</span> maneuver_power_cost
<span class="text-cyan-400">END FUNCTION</span></code></pre>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="bg-white border-t border-slate-200 mt-16">
        <div class="container mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-slate-500">
            <p>&copy; 2024 Interactive Flight Dynamics. All rights reserved.</p>
            <p class="text-sm mt-1">An educational tool based on principles from aerospace engineering research.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const ctx = document.getElementById('powerCurveChart').getContext('2d');
            
            const droneParams = {
                weight: 250 * 9.81, 
                rho: 1.225, 
                area: 19.63, 
                c_d0: 0.04, 
                aspect_ratio: 5, 
                oswald_e: 0.8, 
                battery_kWh: 15,
                k_induced: 1200,
                k_parasitic: 0.005,
                k_profile: 1.5,
            };

            const conditions = {
                calm:       { power_mult: 1.0, speed_offset: 0 },
                headwind:   { power_mult: 1.0, speed_offset: 20 },
                tailwind:   { power_mult: 1.0, speed_offset: -20 },
                turn:       { power_mult: 1.2, speed_offset: 0 },
                turbulence: { power_mult: 1.1, speed_offset: 0 },
                high_alt:   { power_mult: 1.22, speed_offset: 0 }, // Assuming 2000m altitude, approx 22% increase in power for same lift
                ascent:     { power_mult: 1.5, speed_offset: 0 }, // Assuming constant ascent rate, 50% increase
                descent:    { power_mult: 0.7, speed_offset: 0 }, // Assuming controlled descent, 30% reduction
            };
            let currentCondition = 'calm';

            function calculatePowerComponents(speed_kmh, conditionKey = 'calm') {
                const v_ms = speed_kmh / 3.6;
                const effective_v_ms = (speed_kmh + conditions[conditionKey].speed_offset) / 3.6;
                
                const p_induced = (v_ms > 0) ? droneParams.k_induced / v_ms : droneParams.k_induced * 10;
                const p_parasitic = droneParams.k_parasitic * Math.pow(effective_v_ms, 3);
                const p_profile = droneParams.k_profile;
                
                const p_total = (p_induced + p_parasitic + p_profile) * conditions[conditionKey].power_mult;

                return {
                    induced: p_induced * conditions[conditionKey].power_mult,
                    parasitic: p_parasitic * conditions[conditionKey].power_mult,
                    profile: p_profile * conditions[conditionKey].power_mult,
                    total: p_total
                };
            }
            
            const speeds_kmh = Array.from({ length: 150 }, (_, i) => i + 1);
            
            let powerData = {
                induced: [],
                parasitic: [],
                profile: [],
                total: []
            };

            // Moved updatePowerData function definition here
            function updatePowerData(conditionKey) {
                powerData.induced = speeds_kmh.map(s => calculatePowerComponents(s, conditionKey).induced);
                powerData.parasitic = speeds_kmh.map(s => calculatePowerComponents(s, conditionKey).parasitic);
                powerData.profile = speeds_kmh.map(s => calculatePowerComponents(s, conditionKey).profile);
                powerData.total = speeds_kmh.map(s => calculatePowerComponents(s, conditionKey).total);
            }

            // Moved findOptimalSpeeds function definition here
            function findOptimalSpeeds() {
                updatePowerData('calm');
                const totalPowerCalm = powerData.total;

                let minPower = Infinity;
                let vmp_kmh = 0;
                totalPowerCalm.forEach((p, i) => {
                    if (p < minPower) {
                        minPower = p;
                        vmp_kmh = speeds_kmh[i];
                    }
                });
                document.getElementById('vmpValue').textContent = vmp_kmh + ' km/h';

                let maxRangeMetric = 0;
                let vmr_kmh = 0;
                totalPowerCalm.forEach((p, i) => {
                    const speed = speeds_kmh[i];
                    const rangeMetric = speed / p;
                    if (rangeMetric > maxRangeMetric) {
                        maxRangeMetric = rangeMetric;
                        vmr_kmh = speed;
                    }
                });
                document.getElementById('vmrValue').textContent = vmr_kmh + ' km/h';
            }

            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: speeds_kmh,
                    datasets: [
                        { label: 'Induced Power', data: [], borderColor: 'rgba(59, 130, 246, 0.8)', backgroundColor: 'rgba(59, 130, 246, 0.1)', tension: 0.4, borderWidth: 3, pointRadius: 0, fill: false },
                        { label: 'Parasitic Power', data: [], borderColor: 'rgba(239, 68, 68, 0.8)', backgroundColor: 'rgba(239, 68, 68, 0.1)', tension: 0.4, borderWidth: 3, pointRadius: 0, fill: false, hidden: true },
                        { label: 'Profile Power', data: [], borderColor: 'rgba(34, 197, 94, 0.8)', backgroundColor: 'rgba(34, 197, 94, 0.1)', tension: 0.4, borderWidth: 3, pointRadius: 0, fill: false, hidden: true },
                        { label: 'Total Power', data: [], borderColor: 'rgba(17, 24, 39, 0.9)', backgroundColor: 'rgba(17, 24, 39, 0.1)', tension: 0.4, borderWidth: 4, pointRadius: 0, fill: true },
                        { label: 'Current Speed', data: [], type: 'scatter', backgroundColor: 'rgb(8, 145, 178)', pointRadius: 8, pointHoverRadius: 10, showLine: false, order: -1 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: { display: true, text: 'Speed (km/h)', font: { size: 14 } } },
                        y: { title: { display: true, text: 'Power (kW)', font: { size: 14 } }, beginAtZero: true }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y.toFixed(2) + ' kW';
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: { display: false }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    animation: {
                        duration: 500
                    }
                }
            });

            const explanations = {
                induced: { title: 'Induced Power', text: "The power required to generate lift by pushing air downwards. It's highest when hovering and decreases as the drone moves forward and gains aerodynamic lift.", color: 'text-blue-700' },
                parasitic: { title: 'Parasitic Power', text: 'The power needed to overcome air resistance (drag) on the drone\'s body. It increases dramatically with speed.', color: 'text-red-700' },
                profile: { title: 'Profile Power', text: 'The power consumed to spin the propellers themselves, overcoming the drag on the blades. It is relatively constant across different speeds.', color: 'text-green-700' },
                total: { title: 'Total Power', text: 'The sum of all power components. The U-shape shows the trade-off between induced power at low speeds and parasitic power at high speeds.', color: 'text-slate-800' }
            };

            document.querySelectorAll('.power-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.id;
                    const type = id.replace('btn', '').toLowerCase();
                    
                    document.querySelectorAll('.power-btn').forEach(b => {
                        b.classList.remove('bg-blue-500', 'bg-red-500', 'bg-green-500', 'bg-slate-800', 'text-white');
                        if (!b.classList.contains('bg-white')) {
                            b.classList.add('bg-white');
                        }
                    });
                    
                    e.target.classList.remove('bg-white');
                    e.target.classList.add(`bg-${type === 'induced' ? 'blue' : type === 'parasitic' ? 'red' : type === 'profile' ? 'green' : 'slate'}-500`, 'text-white');

                    chart.data.datasets.forEach((dataset, i) => {
                        if (i < 3) { // Only toggle the first 3 datasets
                           dataset.hidden = !dataset.label.toLowerCase().includes(type);
                        }
                    });
                    chart.update();

                    const explanationData = explanations[type];
                    document.getElementById('explanationTitle').textContent = explanationData.title;
                    document.getElementById('explanationText').textContent = explanationData.text;
                    document.getElementById('explanationTitle').className = `font-bold text-lg mb-2 ${explanationData.color}`;
                });
            });

            function updateSimulator() {
                const speed = parseInt(document.getElementById('speedSlider').value);
                document.getElementById('speedValue').textContent = speed;
                
                const power = calculatePowerComponents(speed, currentCondition).total;
                document.getElementById('powerOutput').textContent = power.toFixed(2) + ' kW';

                const flightTime_hr = droneParams.battery_kWh / power;
                const flightTime_min = flightTime_hr * 60;
                document.getElementById('timeOutput').textContent = flightTime_min.toFixed(1) + ' min';

                const groundSpeed = speed + conditions[currentCondition].speed_offset;
                const range_km = groundSpeed * flightTime_hr;
                document.getElementById('rangeOutput').textContent = range_km.toFixed(1) + ' km';

                chart.data.datasets[4].data = [{ x: speed, y: power }];
                chart.update('none'); 
            }

            document.getElementById('speedSlider').addEventListener('input', updateSimulator);
            
            document.querySelectorAll('.condition-btn').forEach(btn => {
                btn.addEventListener('click', e => {
                    document.querySelectorAll('.condition-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentCondition = e.target.dataset.condition;
                    updatePowerData(currentCondition);
                    chart.data.datasets[0].data = powerData.induced;
                    chart.data.datasets[1].data = powerData.parasitic;
                    chart.data.datasets[2].data = powerData.profile;
                    chart.data.datasets[3].data = powerData.total;
                    chart.update();
                    updateSimulator();
                });
            });
            
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.addEventListener('click', e => {
                    const content = e.target.nextElementSibling;
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                        e.target.innerHTML = e.target.innerHTML.replace('▲', '▼');
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                        e.target.innerHTML = e.target.innerHTML.replace('▼', '▲');
                    }
                });
            });

            document.querySelectorAll('.code-tab').forEach(tab => {
                tab.addEventListener('click', e => {
                    document.querySelectorAll('.code-tab').forEach(t => {
                        t.classList.remove('border-cyan-500', 'text-cyan-600');
                        t.classList.add('border-transparent', 'text-slate-500', 'hover:text-slate-700', 'hover:border-slate-300');
                    });
                    e.target.classList.add('border-cyan-500', 'text-cyan-600');
                    e.target.classList.remove('border-transparent', 'text-slate-500');

                    const targetId = e.target.id.replace('tab-', 'code-');
                    document.querySelectorAll('.code-content').forEach(content => {
                        if (content.id === targetId) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });
                });
            });

            const journeyPhases = {
                takeoff: {
                    title: '1. Takeoff & Initial Ascent',
                    explanation: 'The mission begins with a vertical takeoff. This phase demands the highest power, as the rotors must generate enough thrust to overcome the drone\'s entire weight. Induced power is at its maximum here. As the eVTOL transitions from a hover to a gentle forward ascent, the power demand slightly decreases due to dynamic lift. Battery consumption is significant during this initial burst.',
                    assumptions: 'Vertical takeoff, constant ascent rate (e.g., 2 m/s), high instantaneous power draw. Assumed to be a short duration phase.',
                    powerImpact: 'Very High (Peak induced power).'
                },
                cruise_calm: {
                    title: '2. Cruise Flight (Calm Air)',
                    explanation: 'Once airborne, the eVTOL settles into its cruising phase. In calm air, the flight control system will aim for the Maximum Range Speed (V<sub>mr</sub>) to cover the most distance efficiently, or Maximum Endurance Speed (V<sub>mp</sub>) for longest flight time. This is the \'sweet spot\' on the power curve where power consumption is stable and optimized.',
                    assumptions: 'No wind, standard atmospheric pressure (sea level), constant altitude and speed. Drone maintains optimal speed for mission objective.',
                    powerImpact: 'Stable and Optimized (Lowest for given objective).'
                },
                cruise_headwind: {
                    title: '3. Cruise Flight (Headwind)',
                    explanation: 'When flying against a headwind (e.g., 20 km/h), the drone must increase its airspeed to maintain the desired ground speed. This significantly increases parasitic power and overall battery consumption, reducing effective range and endurance.',
                    assumptions: 'Constant headwind (e.g., 20 km/h), drone increases airspeed to compensate. Air density remains constant.',
                    powerImpact: 'Increased (due to higher effective airspeed).'
                },
                cruise_tailwind: {
                    title: '4. Cruise Flight (Tailwind)',
                    explanation: 'With a tailwind (e.g., 20 km/h), the drone can reduce its airspeed while still maintaining the desired ground speed. This leads to lower parasitic drag and reduced power consumption, extending effective range and endurance.',
                    assumptions: 'Constant tailwind (e.g., 20 km/h), drone reduces airspeed to compensate. Air density remains constant.',
                    powerImpact: 'Reduced (due to lower effective airspeed).'
                },
                high_altitude: {
                    title: '5. High Altitude Cruise',
                    explanation: 'At higher altitudes (e.g., 2000m), air density (ρ) is lower. To generate the same amount of lift required to stay airborne, the rotors must spin faster. This increases overall power consumption, meaning a given battery capacity yields less range/endurance.',
                    assumptions: 'Constant altitude (e.g., 2000m), reduced air density compared to sea level. Power multiplier reflects increased effort for lift.',
                    powerImpact: 'Increased (due to lower air density).'
                },
                flight_turns: {
                    title: '6. Flight Turns',
                    explanation: 'During maneuvers like turns, the eVTOL requires additional power. This extra power is needed to generate the necessary centripetal force to change direction while simultaneously maintaining altitude. This temporary increase in power draw impacts the overall battery budget.',
                    assumptions: 'Standard turn maneuver, temporary increase in power. Speed is generally maintained or slightly reduced.',
                    powerImpact: 'Temporary Increase.'
                },
                ascent_maneuver: {
                    title: '7. Ascent Maneuver',
                    explanation: 'A sustained ascent to gain altitude requires a significant increase in power. The drone needs to generate thrust not only to counteract gravity but also to accelerate vertically. This is a high-power phase, though typically less demanding than initial takeoff.',
                    assumptions: 'Constant vertical climb rate (e.g., 2 m/s). Power is significantly higher than level flight.',
                    powerImpact: 'Significantly Increased.'
                },
                descent_landing: {
                    title: '8. Descent & Landing',
                    explanation: 'As the eVTOL approaches its destination, it initiates a controlled descent. This phase typically requires less power than ascent, and in some cases, can even involve some energy recovery (though minimal for quadcopters). The drone reduces its forward speed, transitions back to a near-hover state, and then performs a precise vertical landing. The final moments of hovering before touchdown again see a peak in induced power, similar to takeoff, but for a shorter duration.',
                    assumptions: 'Controlled descent, transition to hover speed, vertical landing. Power consumption is generally lower than cruise, with a final peak at hover.',
                    powerImpact: 'Reduced (compared to cruise), then temporary peak at final hover.'
                }
            };

            function updateJourneyDetail(phaseKey) {
                const phase = journeyPhases[phaseKey];
                document.getElementById('journey-title').textContent = phase.title;
                document.getElementById('journey-explanation').textContent = phase.explanation;
                document.getElementById('journey-assumptions').innerHTML = `<b>Assumptions:</b> ${phase.assumptions}`;
                document.getElementById('journey-power-impact').innerHTML = `<b>Power Impact:</b> ${phase.powerImpact}`;
            }

            document.querySelectorAll('.journey-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.journey-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    updateJourneyDetail(e.target.dataset.phase);
                });
            });


            // Initial setup
            findOptimalSpeeds(); // Call the function after its definition
            document.querySelector('.condition-btn[data-condition="calm"]').click();
            document.getElementById('btnInduced').click();
            updateSimulator();
            document.querySelector('.journey-btn[data-phase="takeoff"]').click(); // Initialize journey detail area
        });
    </script>
</body>
</html>
